<!-- This layout is used in all pages. Making changes here will efect all pages. We recommend not to change anything here. --> <!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /><link rel="dns-prefetch" href="//fonts.googleapis.com" /><link rel="dns-prefetch" href="//google-analytics.com" /><link rel="dns-prefetch" href="//www.google-analytics.com" /><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com" /><link rel="dns-prefetch" href="//ajax.googleapis.com" /><link rel="dns-prefetch" href="//fonts.gstatic.com" /><link rel="dns-prefetch" href="https://.disqus.com/" /><title>VMWare Pro Homelab Active Directory Forest Setup pt. 1 | My Portfolio</title><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="VMWare Pro Homelab Active Directory Forest Setup pt. 1" /><meta name="author" content="Ethan Epperson" /><meta property="og:locale" content="en_US" /><meta name="description" content="Creating the Active Directory Network VMs" /><meta property="og:description" content="Creating the Active Directory Network VMs" /><link rel="canonical" href="http://localhost:4000/blog/homelab-ad-forest/" /><meta property="og:url" content="http://localhost:4000/blog/homelab-ad-forest/" /><meta property="og:site_name" content="My Portfolio" /><meta property="og:image" content="http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-13T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg" /><meta property="twitter:title" content="VMWare Pro Homelab Active Directory Forest Setup pt. 1" /><script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ethan Epperson"},"dateModified":"2024-01-13T00:00:00-05:00","datePublished":"2024-01-13T00:00:00-05:00","description":"Creating the Active Directory Network VMs","headline":"VMWare Pro Homelab Active Directory Forest Setup pt. 1","image":"http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/homelab-ad-forest/"},"url":"http://localhost:4000/blog/homelab-ad-forest/"}</script><link rel="stylesheet" href="/assets/css/main-default.css" /><link id="color-scheme" rel="stylesheet" href="/assets/css/main-default.css" /><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/apple-icon-60x60.png" /><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-icon-114x114.png" /><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/apple-icon-152x152.png" /><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/android-icon-192x192.png" /><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><link rel="icon" href="/favicon.ico" type="image/x-icon" /><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" ></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script></head><body><div class="loader"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div><div class="wrapper"><div class="container-grid"><div class="sidebar"><div class="author-container shadow"><div class="author"> <a href="/"> <img src="/assets/images/headshots/professional-hs.jpg" width="100%" height="auto;" alt="My Portfolio"loading="lazy" /> </a></div><div class="about text-center"><h1 class="title"><a href="/">Ethan Epperson</a></h1></div><div class="bio text-center"><p class="m0">Cybersecurity Student | Let's Defend Together</p></div><hr class="dashed"><div class="social text-center"> <ul class="portfolio p0"> <li><a href="/projects/">Projects</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="/contact/">Contact</a></li> </ul> <ul class="sm p0 m0a"> <li><a href="https://www.linkedin.com/in/ethan-epperson-8608b5277"><i class="fa fa-linkedin"></i></a></li> <li><a href="https://www.github.com/EEpp14"><i class="fa fa-github"></i></a></li> </ul></div></div></div><div class="main"><div class="main-container shadow"><div class="title-space"> <h1>VMWare Pro Homelab | Active Directory Forest Setup pt. 1</h1><div class="input-group mb-3" data-aos="zoom-in"> <input type="text" class="form-control border-right-0" id="search-input" /><div class="input-group-append"> <span class="input-group-text" ><i class="fa fa-search"></i ></span></div></div></div><hr class="dashed" /> <main> <ul class="breadcrumbs"> <li><a href="/">Home</a></li> <li> <a href="/blog" >Blog</a > </li> <li> <a href="#" >Homelab ad forest</a > </li> </ul><div class="meta" data-aos="fade-up"> <p> <small> <span> <i class="fa fa-calendar" aria-hidden="true"></i> 13 Jan 2024&nbsp; </span> <span> <i class="fa fa-user" aria-hidden="true"></i> Ethan Epperson&nbsp; </span> <span> <i class="fa fa-clock-o" aria-hidden="true"></i> 6 mins read. </span> </small> </p></div><div class="featured-image rounded shadow" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg)" data-aos="zoom-in" ></div><div class="container"> <article> <ul class="toc"> <li><a href="#creating-the-active-directory-network-vms">Creating the Active Directory Network VMs</a></li> <li><a href="#installing-windows-server-2019">Installing Windows Server 2019</a></li> <li><a href="#configuring-the-server-as-domain-controller">Configuring the Server as Domain Controller</a></li> <li><a href="#configuring-server-as-certificate-authority">Configuring Server as Certificate Authority</a></li> </ul> <h2 id="creating-the-active-directory-network-vms">Creating the Active Directory Network VMs</h2> <p>Here are the minimum specifications and dhcp allocations within the webConfigurator for the server and client machine. We will not be setting up the 2nd client machine at this time because we are going to clone the first client VM after OS installation to save ourselves time and effort.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-specs.jpg" alt="Windows Server 2019 Specifications" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/opt2-dhcp.jpg" alt="OPT2 Static DHCP Allocations" /></p> <h2 id="installing-windows-server-2019">Installing Windows Server 2019</h2> <p>Power on the machine and make sure to press any key to boot from the CD/DVD drive or you will get a time out error. You will be introduced to the ‘Windows Setup’ wizard. Choose your language, time, and keyboard settings and click ‘Next’. Click ‘Install Now’ after that. When it asks which operating system you want to use, select the standard evaluation with desktop experience. On the next page, accept the license agreement. After that, we want to select the custom installation option. Choose the drive we have already created and click ‘Next;. The server will now begin installing, so this may take some time. Once it’s complete, you will have to make a password for the admin account. Click ‘Finish’ once done.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-setup.jpg" alt="Server Setup Wizard" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-license.jpg" alt="Server Setup License Agreement" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-os.jpg" alt="Server Setup OS Selection" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-custom.jpg" alt="Server Setup Custom Installation" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-drive.jpg" alt="Server Setup Wizard Drive Selection" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-installing.jpg" alt="Server Setup Wizard Installing" /></p> <p>Make sure you don’t choose too complex of a password as we want to make this domain actively weak.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-password.jpg" alt="Server Setup Wizard Password Creation" /></p> <p>Now we can login. To send a ctrl-alt-del to the virtual machine you can press the highlighted button below to do so. Once in we can do a quick ipconfig to make sure that pfSense DHCP is working correctly for this machine.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/vmware-ctrl.jpg" alt="VMWare ctrl-alt-del" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-cmd.jpg" alt="Windows Server Connection Test" /></p> <p>Now that we know everything is in working order we can setup our server to act a a domain controller, but first let’s rename the machine. Go to the search bar and type ‘settings’ to access server settings. On the settings window, search once again for ‘pc name’ and choose the option that appears. Under ‘Device specifications’ you can then change the device name to whatever you please. Go with whatever theme you want. Now we must restart for the change to take effect.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-search.jpg" alt="Windows Server Search Settings" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-search2.jpg" alt="Windows Server Search PC Name" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-rename.jpg" alt="Windows Server Renaming Device" /></p> <h2 id="configuring-the-server-as-domain-controller">Configuring the Server as Domain Controller</h2> <p>When we log in again, we should be greeted with the ‘Server Manager’. This is the interface we will be using to configure the DC. Go to ‘Manage’ → ‘Add Roles and Features’. The wizard will launch, click through until you get to ‘Server Roles’. Once there we are going to skip through the ‘Before you Begin’ section. Under ‘Installation Type’ we are going to leave it at role-based/feature-based. On ‘Server Selection’, our current server should be selected by default so skip through this part. For ‘Server Roles’, we are going to select active directory domain service. For ‘Features’, we don’t need to select anything additional. Skip through the ‘AD DS’ and ‘AD CS’ screen,s and then confirm and install, Once it’s finished we will need to manually reboot, so go ahead and do so.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles.jpg" alt="Server Roles and Features Wizard" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-begin.jpg" alt="Server Roles and Features Wizard Beginning" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-type.jpg" alt="Server Roles and Features Wizard Installation Type" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-selection.jpg" alt="Server Roles and Features Wizard Server Selection" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-ds.jpg" alt="Server Roles and Features Wizard Domain Controller" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-features.jpg" alt="Server Roles and Features Wizard Features" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-adds.jpg" alt="Server Roles and Features Wizard AD DS" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-confirmation.jpg" alt="Server Roles and Features Wizard Confirm Installation" /></p> <p>Once it’s restarted, We can go back to the server manager to configure the domain controller. There should be a flag with a yellow caution sign in the menu bar up top, let’s click on it. When we do, we should see the option ‘Promote this server to a domain controller’. Click on it to launch the domain services configuration wizard.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-promote.jpg" alt="DC Configuration Promote" /></p> <p>Select ‘Add a new forest’ and choose a root domain name. On ‘Domain Controller Options’, choose a recovery password and leave as default. For ‘DNS Options’ we can ignore the warning and continue. Skip past ‘Additional Options’ and ‘Paths’, leaving them as default. Click past ‘Review Options’. On the ‘Prerequisite Check’ screen, you should see three warnings, but those are to be ignored as well. We can then begin installation. Once it’s done it will automatically restart after a short period. Once it’s restarted we can configure the server as a certificate authority.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-deploy.jpg" alt="DC Configuration Wizard Deployment" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-options.jpg" alt="DC Configuration Wizard Domain Controller Options" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-dns.jpg" alt="DC Configuration Wizard DNS Options" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-additional.jpg" alt="DC Configuration Wizard Additional Options" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-paths.jpg" alt="DC Configuration Wizard Additional Options" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-review.jpg" alt="DC Configuration Wizard Review Options" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-prereq.jpg" alt="DC Configuration Wizard Prerequisite Check" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/dc-results.jpg" alt="DC Configuration Wizard Prerequisite Check" /></p> <h2 id="configuring-server-as-certificate-authority">Configuring Server as Certificate Authority</h2> <p>This process is the same as above except when we get to ‘Server Roles’ in the roles and features setup wizard, we need to choose ‘Active Directory Certificate Services’ instead. Under ‘Role Services’ leave it as default.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-certauth.jpg" alt="Server Roles and Features Wizard Server Roles" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-adcs.jpg" alt="Server Roles and Features Wizard AD CS" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/server-roles-adcs-services.jpg" alt="Server Roles and Features Wizard Role Services" /></p> <p>Like before, go to the top menu bar and click the yellow caution sign under the flag and click ‘Configure Active Directory Certificate Services on the destination server’. The wizard will launch. Make sure every step looks identical to the images below. Once it’s done installing, the machine will restart automatically.</p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-credentials.jpg" alt="AD CS Configuration Credentials" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-roles.jpg" alt="AD CS Configuration Role Services" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-setuptype.jpg" alt="AD CS Configuration Setup Type" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-catype.jpg" alt="AD CS Configuration CA Type" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-key.jpg" alt="AD CS Private Key" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-crypto.jpg" alt="AD CS Cryptography" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-caname.jpg" alt="AD CS CA Name" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-validity.jpg" alt="AD CS CA Validity" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-certdb.jpg" alt="AD CS Configuration Certificate Database" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-confirm.jpg" alt="AD CS Configuration Confirmation" /></p> <p><img src="/assets/images/homelab/activedir-vms-setup/adcs-results.jpg" alt="AD CS Configuration Results" /></p> <p>Congrats, you are halfway done with setting up your AD forest in your AD subnet. In the next part, we will cover how to create new user account objects, setup an SPN for SQL service, open SMB ports, and join client machines to the forest. You can find it in the further reading section below or in the sidebar under ‘Categories’ → ‘Homelab’.</p> </article></div><hr class="dashed" /><div class="container"><div class="row"><div class="col-md-12"> <p class="categories" data-aos="fade-up"> <span ><a href="/categories/#blog" >Blog</a ></span > </p></div></div><div class="recent" data-aos="fade-up"><div class=""> <h3>Recent Articles</h3></div><div class="recent-grid"><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-wazuh/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-wazuh.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Monitoring Suricata/Windows Logs With Wazuh</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-suricata/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-suricata.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Suricata Setup on pfSense with Snort Alerts</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-ad-forest-pt.2/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Active Directory Forest Setup pt. 2</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-dvwa/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-dvwa.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | DVWA Setup on Ubuntu Server</small></p></div></a></div></div></div></div></main><div id="search-container"></div><hr class="dashed" /><footer data-aos="fade-up"><div class="text-right"> <p class="copy"> <i class="fa fa-at"></i> 2018 <a class="rev" href="/">Blackcurrant</a> </p></div></footer></div></div></div></div><script src="/assets/js/jQuery.min.js"></script><script> $(document).ready(function () { $(".loader").hide(); });</script><script> (function () { var css = document.createElement("link"); css.href = "/assets/font-awesome-4.7.0/css/font-awesome.min.css"; css.rel = "stylesheet"; css.type = "text/css"; document.getElementsByTagName("head")[0].appendChild(css); })();</script><noscript><link rel="stylesheet" href="/assets/font-awesome-4.7.0/css/font-awesome.min.css" /> </noscript><script> $("#search-input").keyup(function () { $("main").hide(); $("search-container").show(); if (!$("#search-input").val()) { $("main").show(); $("search-container").hide(); } });</script><script src="/assets/js/jekyll-search.min.js"></script><script> SimpleJekyllSearch({ searchInput: document.getElementById("search-input"), resultsContainer: document.getElementById("search-container"), searchResultTemplate: '<a class="nostyle" href="{url}"><div class="blog borders cards"><div class="image" style="background-image: url({image});"></div><div class="content"><h3 class="title">{title}</h3><p class="description">{description}</p></div></div></a>', noResultsText: "No results found", json: "/search.json", });</script><script> (function () { var css = document.createElement("link"); css.href = "https://unpkg.com/aos@2.3.1/dist/aos.css"; css.rel = "stylesheet"; css.type = "text/css"; document.getElementsByTagName("head")[0].appendChild(css); })();</script><noscript><link rel="stylesheet" href="/assets/animate-on-scroll/aos.min.css" /> </noscript><script src="/assets/animate-on-scroll/aos.min.js"></script><script> AOS.init({ duration: 600, once: true, disable: "mobile", });</script></body></html>