<!-- This layout is used in all pages. Making changes here will efect all pages. We recommend not to change anything here. --> <!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /><link rel="dns-prefetch" href="//fonts.googleapis.com" /><link rel="dns-prefetch" href="//google-analytics.com" /><link rel="dns-prefetch" href="//www.google-analytics.com" /><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com" /><link rel="dns-prefetch" href="//ajax.googleapis.com" /><link rel="dns-prefetch" href="//fonts.gstatic.com" /><link rel="dns-prefetch" href="https://.disqus.com/" /><title>VMWare Pro Homelab Services &amp; Firewall Setup | My Portfolio</title><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="VMWare Pro Homelab Services &amp; Firewall Setup" /><meta name="author" content="Ethan Epperson" /><meta property="og:locale" content="en_US" /><meta name="description" content="webConfigurator Setup Wizard" /><meta property="og:description" content="webConfigurator Setup Wizard" /><link rel="canonical" href="http://localhost:4000/blog/homelab-pfsense-webConfigurator/" /><meta property="og:url" content="http://localhost:4000/blog/homelab-pfsense-webConfigurator/" /><meta property="og:site_name" content="My Portfolio" /><meta property="og:image" content="http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-pfsense.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-08T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-pfsense.jpg" /><meta property="twitter:title" content="VMWare Pro Homelab Services &amp; Firewall Setup" /><script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ethan Epperson"},"dateModified":"2024-01-08T00:00:00-05:00","datePublished":"2024-01-08T00:00:00-05:00","description":"webConfigurator Setup Wizard","headline":"VMWare Pro Homelab Services &amp; Firewall Setup","image":"http://localhost:4000/assets/images/thumbnails/homelab/Homelab-setup-guide-pfsense.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/homelab-pfsense-webConfigurator/"},"url":"http://localhost:4000/blog/homelab-pfsense-webConfigurator/"}</script><link rel="stylesheet" href="/assets/css/main-default.css" /><link id="color-scheme" rel="stylesheet" href="/assets/css/main-default.css" /><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/apple-icon-60x60.png" /><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-icon-114x114.png" /><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/apple-icon-152x152.png" /><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/android-icon-192x192.png" /><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><link rel="icon" href="/favicon.ico" type="image/x-icon" /><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" ></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script></head><body><div class="loader"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div><div class="wrapper"><div class="container-grid"><div class="sidebar"><div class="author-container shadow"><div class="author"> <a href="/"> <img src="/assets/images/headshots/professional-hs.jpg" width="100%" height="auto;" alt="My Portfolio"loading="lazy" /> </a></div><div class="about text-center"><h1 class="title"><a href="/">Ethan Epperson</a></h1></div><div class="bio text-center"><p class="m0">Cybersecurity Student | Let's Defend Together</p></div><hr class="dashed"><div class="social text-center"> <ul class="portfolio p0"> <li><a href="/projects/">Projects</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="/contact/">Contact</a></li> </ul> <ul class="sm p0 m0a"> <li><a href="https://www.linkedin.com/in/ethan-epperson-8608b5277"><i class="fa fa-linkedin"></i></a></li> <li><a href="https://www.github.com/EEpp14"><i class="fa fa-github"></i></a></li> </ul></div></div></div><div class="main"><div class="main-container shadow"><div class="title-space"> <h1>VMWare Pro Homelab | Services & Firewall Setup</h1><div class="input-group mb-3" data-aos="zoom-in"> <input type="text" class="form-control border-right-0" id="search-input" /><div class="input-group-append"> <span class="input-group-text" ><i class="fa fa-search"></i ></span></div></div></div><hr class="dashed" /> <main> <ul class="breadcrumbs"> <li><a href="/">Home</a></li> <li> <a href="/blog" >Blog</a > </li> <li> <a href="#" >Homelab pfsense w...</a > </li> </ul><div class="meta" data-aos="fade-up"> <p> <small> <span> <i class="fa fa-calendar" aria-hidden="true"></i> 08 Jan 2024&nbsp; </span> <span> <i class="fa fa-user" aria-hidden="true"></i> Ethan Epperson&nbsp; </span> <span> <i class="fa fa-clock-o" aria-hidden="true"></i> 9 mins read. </span> </small> </p></div><div class="featured-image rounded shadow" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-pfsense.jpg)" data-aos="zoom-in" ></div><div class="container"> <article> <ul class="toc"> <li><a href="#webconfigurator-setup-wizard">webConfigurator Setup Wizard</a></li> <li><a href="#enabling-network-services">Enabling Network Services</a></li> <li><a href="#dns-query-forwarding">DNS Query Forwarding</a></li> <li><a href="#enabling-ntp">Enabling NTP</a></li> <li><a href="#firewall-alias-and-firewall-rules">Firewall Alias and Firewall Rules</a></li> </ul> <h2 id="webconfigurator-setup-wizard">webConfigurator Setup Wizard</h2> <p>This post focuses on using pfSense’s web application interface, the webConfigurator, to setup pfSense, enable services, and create firewall aliases/rules. To access the webConfigurator, go to 10.0.11.1. Accept the risk and you will then be greeted with the login page. The credentials are set to the default, so input ‘admin’ for the user and ‘pfSense’ for the password. Once you’re in, you will immediately be placed in the pfSense Setup Wizard. Click ‘» Next’ twice to get to the ‘General Information’ screen.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/wizard-start.jpg" alt="webConfigurator Setup Wizard" /></p> <p>On the ‘General Information’ screen we have the option to change the name of our firewall, define a domain name, and set a primary and secondary dns servers. If you’d like to change any of these settings or use your own dns addresses, then go ahead and change them now. I will personally be using Cloudflare’s Secure DNS IPv4 addresses as they offer added malware protection. Note that we will have to enable DNS Query Forwarding if we don’t want our DNS configurations to be overridden. We also need to uncheck the ‘Override DNS’ box.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/wizard-general.jpg" alt="webConfigurator Setup Wizard" /></p> <p>Leave the timezone screen as is unless you have internal NTP servers on your network. After that we have the ‘Configure WAN interface’ screen. We don’t need to mess with this page too much as we already did most of the legwork in the pfSense command line. We will let local DHCP handle the IP for WAN. We only need to uncheck ‘Block RFC1918 Private Networks’ and ‘Block bogon networks’ as we will be configuring our own default deny rules. The next screen involves the LAN interface IP. We’ve already set this, so we can skip this part.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/wizard-blockrules.jpg" alt="webConfigurator Disable Block Rules" /></p> <p><img src="/assets/images/homelab/webconfigurator-setup/wizard-lan.jpg" alt="webConfigurator LAN Setup" /></p> <p>On this screen we will need to enter a new admin password. Store it in a secure location such as a password manager. Click through to the next screen and refresh when you are asked. Wait for the setup to finish, and congrats you’ve made it through the initial webConfigurator setup. You will then be booted to the dashboard to accept the copyright agreement. On the dashboard is where we can view information about our system, disk usage, and which interfaces are connected to pfSense.</p> <p>It’s always good practice to make sure pfSense is up to date. We can check the update status by going to ‘System’ → ‘Updates’ → ‘System Updates’. Everything should be up to date because we used the most recent ISO for installation. Before we added Cloudflares public DNS servers in the wizard, but we are also going to add some extra Quad 9 DNS servers. Under ‘DNS Server Settings’ make sure to add them below the Cloudflare addresses. We also need to make sure that ‘Allow DNS server list to be overridden by DHCP/PPP on WAN or remote OpenVPN server’ is disabled so that our servers are not overridden by DHCP. If you’d like to use dark mode, go to ‘System’ → ‘General Setup’ → ‘webConfigurator’ and there you can change the theme from the dropdown.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/wc-updates.jpg" alt="webConfigurator System Updates" /></p> <p><img src="/assets/images/homelab/webconfigurator-setup/wc-dns.jpg" alt="webConfigurator DNS Servers" /></p> <p><img src="/assets/images/homelab/webconfigurator-setup/wc-theme.jpg" alt="webConfigurator Theme Selection" /></p> <h2 id="enabling-network-services">Enabling Network Services</h2> <p>We are ready to setup the services we wish to use. We will be making use of DNS query forwarding for caching, NTP for accurate time-keeping, and DHCP for static IP allocation (although we will get to this at a later part). Let’s start with DNS forwarding first since the setup wizard directed us to make DNS resolver changes in order to use the manual DNS servers we configured.</p> <h2 id="dns-query-forwarding">DNS Query Forwarding</h2> <p>Head to ‘Services’ → ‘DNS Resolver’. The DNS resolver should be enabled by default. Under ‘Network Interfaces’, highlight ‘LAN’, ‘OPT1’, ‘OPT2’ and ‘Localhost’ by ctrl-clicking them, and then highlight WAN in ‘Outgoing Network Interfaces’. Check the box for ‘Enable Forwarding Mode’. You can enable DoT if you’d like, but I will not be doing so. Save and apply your changes. If you need to troubleshoot DNS issues then you can go to ‘Diagnostics’ → ‘DNS Lookup’ to run commands and make sure that connections are being established. If not, check the DNS addresses you set and make sure you didn’t make a typo.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/dnsresolver-interfaces.jpg" alt="DNS Resolver Network Interfaces" /></p> <p><img src="/assets/images/homelab/webconfigurator-setup/dnsresolver-forwarding.jpg" alt="DNS Resolver Forwarding" /></p> <h2 id="enabling-ntp">Enabling NTP</h2> <p>In the setup wizard we decided to use the pfSense NTP server, in this section we are going to configure it’s settings. NTP is used to synchronize clock times in networks. Many critical services require accurate time keeping to function properly. Go to ‘Services’ → ‘NTP’. ctrl-click ‘LAN’, ‘OPT1’, and ‘OPT2’. We are going to add some additional North American time servers from pool.ntp.org. They should all be of type ‘Pool’ by default, but if not then change them. NTP is now properly configured.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/wc-ntp.jpg" alt="NTP Configuration" /></p> <h2 id="firewall-alias-and-firewall-rules">Firewall Alias and Firewall Rules</h2> <p>In pfSense, we are able to create aliases that allow groupings of ports, hosts, network ranges, IP addresses, and URLS under a single name. Instead of manually specifying multiple IPs for a firewall rule, we can simply point it to the aliases we create making firewall rule creation much less tedious. We are going to need to create several aliases. For that we need to go to ‘Firewall’ → ‘Aliases’. The ‘IP’ and ‘Ports’ tabs will be the main focus. Make sure your aliases looks identical to the ones below, and don’t forget to save and apply changes.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-ip-aliases.jpg" alt="Firewall IP Aliases Creation" /></p> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-port-aliases.jpg" alt="Firewall Port Aliases Creation" /></p> <p>Now that our aliases are created, we can move onto creating the firewall rules. Let’s look at an example first. Head to ‘Firewall’ → ‘Rules’ → ‘LAN’. It is incredibly important to note, <em>firewall rules are executed in a first to last, top to bottom order.</em> We always need to be very careful about how we place them. When you arrive at the LAN tab, you will see three default rules. The topmost one is an anti-lockout rule that allows HTTP/HTTPS traffic to access pfSense on the LAN interface. The other two rules allow IPv4/6 outbound traffic from the LAN. We cannot drag the lockout rule around as it must always come first. Other rules are able to be placed in whichever order we choose. Let’s go ahead and delete the bottom two rules as we won’t need those in our LAN policy. Let’s also create a better anti-lockout rule as an example (We will be disabling the default anti-lockout rule later). Click on the anti-lockout rule and then the ‘Add rule to end of the list’ option (the add button with the down arrow marker). A new window will open in which we can create our rule. Make sure it looks similar to the image below. Save and apply changes.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-sample-rule.jpg" alt="Firewall LAN Rules Example" /></p> <p>Now that we understand proper firewall rule order and how to create rules. Let’s create our policies for WAN, LAN, OPT1, and OPT2 in that order. Make sure that your rules match the images provided. I will explain each rule-set as we go.</p> <ol> <li><strong>WAN</strong>:</li> <li>The firewall will automatically create a default deny-all rule for inbound traffic to the WAN, but this rule serves as an explicit visual notifier</li> </ol> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-wan.jpg" alt="Firewall WAN Rules" /></p> <ol> <li><strong>LAN</strong>: (The default anti-lockout rule is not included in this list because we will be removing it later) <ul> <li>A better anti-lockout rule that only allows us to access the webConfigurator via the LAN address at port 443(HTTPS)</li> <li>Rules for allowing VMs in the management network to access the DNS and NTP services</li> <li>A rule that lets the hosted hypervisor make SSH connections to our LAN interface</li> <li>A rule that lets the hosted hypervisor make RDP connections to our active directory network</li> <li>A rule for establishing an HTTP/HTTPS connection from our Kali VM to our DVWA machine. We will not be accessing the web application on the machine that DVWA is installed on, but through Kali instead.</li> <li>A rule for establishing any IPv4 connection from Kali to the vulnerable VMs</li> <li>A rule for establishing any IPv4 connection from Kali to the AD VMs</li> <li>An RFC1918 rule meant to enforce segmentation. It’s essential that we have all rules dealing with RFC1918 addresses above this rule so services or other important communications are not blocked.</li> <li>Rules that allow the management machines to make outbound HTTP/HTTPS, NTP, and ICMP connections</li> <li>An explicit deny-any rule that blocks all other inbound connections</li> </ul> </li> </ol> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-lanrules.jpg" alt="Firewall LAN Rules" /></p> <ol> <li><strong>OPT1</strong>: <ul> <li>A rule to block our vulnerable VMs from making outbound connections, enforcing proper security in isolating the network from other segments and the internet</li> <li>Rule for allowing VMs in the isolated network to access the DNS and NTP services.</li> <li>An RFC1918 rule meant to enforce segmentation</li> <li>Rules that allow the isolated machines to make outbound HTTP/HTTPS, NTP, and ICMP connections</li> <li>An explicit deny-any rule that blocks all other inbound connections</li> </ul> </li> </ol> <p>You might have noticed that our vulnerable machines alias did not include the Linux machine that DVWA will be running on. That is because we need the machine to be able to use HTTPS/NTP so we can install DVWA. Once we have everything setup, we will be deleting those permissions and adding the machine to the vulnerable machines alias.</p> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-opt1rules.jpg" alt="Firewall OPT1 Rules" /></p> <ol> <li><strong>OPT2</strong>: <ul> <li>A rule that allows Winlogbeats traffic to be sent to the SIEM</li> <li>Rules for allowing VMs in the AD network to access the DNS and NTP services.</li> <li>An RFC1918 rule meant to enforce segmentation</li> <li>Rules that allow the AD machines to make outbound HTTP/HTTPS, NTP, and ICMP connections</li> <li>An explicit deny-any rule that blocks all other inbound connections</li> </ul> </li> </ol> <p><img src="/assets/images/homelab/webconfigurator-setup/fw-opt2rules.jpg" alt="Firewall OPT2 Rules" /></p> <table> <tbody> <tr> <td>Congrats, you’ve made it through all of the services and firewall setup! We can now move onto creating the management network virtual machines. You can find the next part, ‘VMWare Pro Homelab</td> <td>Tsurugi &amp; Kali Linux Setup’, in the [blog] section of this site.</td> </tr> </tbody> </table> </article></div><hr class="dashed" /><div class="container"><div class="row"><div class="col-md-12"> <p class="categories" data-aos="fade-up"> <span ><a href="/categories/#blog" >Blog</a ></span > </p></div></div><div class="recent" data-aos="fade-up"><div class=""> <h3>Recent Articles</h3></div><div class="recent-grid"><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-wazuh/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-wazuh.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Monitoring Suricata/Windows Logs With Wazuh</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-suricata/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-suricata.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Suricata Setup on pfSense with Snort Alerts</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-ad-forest-pt.2/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Active Directory Forest Setup pt. 2</small></p></div></a></div><div class="items" data-aos="fade-up"> <a class="nostyle item" href="/blog/homelab-ad-forest/"><div class="cards"><div class="image rounded" style="background-image: url(/assets/images/thumbnails/homelab/Homelab-setup-guide-windows.jpg)" ></div><p class="title"><small>VMWare Pro Homelab | Active Directory Forest Setup pt. 1</small></p></div></a></div></div></div></div></main><div id="search-container"></div><hr class="dashed" /><footer data-aos="fade-up"><div class="text-right"> <p class="copy"> <i class="fa fa-at"></i> 2018 <a class="rev" href="/">Blackcurrant</a> </p></div></footer></div></div></div></div><script src="/assets/js/jQuery.min.js"></script><script> $(document).ready(function () { $(".loader").hide(); });</script><script> (function () { var css = document.createElement("link"); css.href = "/assets/font-awesome-4.7.0/css/font-awesome.min.css"; css.rel = "stylesheet"; css.type = "text/css"; document.getElementsByTagName("head")[0].appendChild(css); })();</script><noscript><link rel="stylesheet" href="/assets/font-awesome-4.7.0/css/font-awesome.min.css" /> </noscript><script> $("#search-input").keyup(function () { $("main").hide(); $("search-container").show(); if (!$("#search-input").val()) { $("main").show(); $("search-container").hide(); } });</script><script src="/assets/js/jekyll-search.min.js"></script><script> SimpleJekyllSearch({ searchInput: document.getElementById("search-input"), resultsContainer: document.getElementById("search-container"), searchResultTemplate: '<a class="nostyle" href="{url}"><div class="blog borders cards"><div class="image" style="background-image: url({image});"></div><div class="content"><h3 class="title">{title}</h3><p class="description">{description}</p></div></div></a>', noResultsText: "No results found", json: "/search.json", });</script><script> (function () { var css = document.createElement("link"); css.href = "https://unpkg.com/aos@2.3.1/dist/aos.css"; css.rel = "stylesheet"; css.type = "text/css"; document.getElementsByTagName("head")[0].appendChild(css); })();</script><noscript><link rel="stylesheet" href="/assets/animate-on-scroll/aos.min.css" /> </noscript><script src="/assets/animate-on-scroll/aos.min.js"></script><script> AOS.init({ duration: 600, once: true, disable: "mobile", });</script></body></html>